# 11/21/2025 Edits

**Author:** Harsh Arya  
**Date:** 2025-11-21  

## Data & Loading

- **Before:** All charts relied on a tiny, hand-coded subset of regions/countries and a few snapshot years, so many visualizations felt sparse or misleading and could not reflect the full 1960–2020 World Bank dataset.
- Replaced the hard-coded sample data in `data-loader.js` with loaders that use the full World Bank dataset from `world-bank-data/`:
  - Joined `economy-and-growth/economy-and-growth.csv` (GDP and GDP per capita), `health/health.csv` (population), and `social-development/social-development.csv` (life expectancy) using country code and year.
  - Built `healthData[year]` as a panel of `{ country, countryCode, year, gdpPerCapita, lifeExpectancy, population, region }`.
  - Built `regionalGDPData[year]` as regional aggregates (GDP in trillions, population in millions) using World Bank regions mapped to our 7 display regions.
- Filtered out aggregate entities (e.g., “World”, “High income”, “OECD members”) by skipping rows without a proper World Bank region, so only real countries appear in all downstream charts.
- Added `whenDataReady()` and wired `main-new.js` to wait for data before rendering any visualization.

## Layout & Sizing

- **Before:** Several charts (stream graph, bubble chart, radar, trajectories) were cramped in a two-column grid and appeared much smaller than the racing bar chart, making them hard to read.
- Switched the visualization grid (`.viz-grid` in `style.css`) to a single-column layout so **only one plot spans the width of the page at a time**.
- Increased default visualization container heights and set all SVGs to `width: 100%; height: 100%` so `stream-graph`, `bubble-chart`, `radar-chart`, and `trajectory-chart` are comparable in footprint to the racing bar chart.

## Top 10 Countries Race

- **Before:** The race chart only used GDP per capita (ignoring the metric dropdown), sometimes showed aggregate regions like “OECD members”, and lacked a direct way to scrub time, which made it confusing and partially broken.
- Rewrote the race chart in `main-new.js` to:
  - Respect the metric dropdown (`Total GDP`, `Population`, `Life Expectancy`) via a shared metric config (`accessor` + `format`).
  - Use **Total GDP ≈ GDP per capita × population** for the GDP metric.
  - Display metric-appropriate labels (trillions for GDP, millions for population, years for life expectancy).
- Added a **year slider** (`race-year-slider` + `race-year-display`) so the user can scrub through time when the animation is paused.
- Made the play/pause button step through years using the same render function as the slider.

## Bubble Chart – Wealth, Health & Population

- **Before:** Aggregate entities (e.g., “High income”) appeared as very large bubbles, so Europe and other groups looked like they had the largest “populations”, and bubble sizes did not reflect individual country populations.
- Fixed bubble sizing by:
  - Ensuring population comes from the full `health.csv` and removing aggregate rows so only real countries are plotted.
  - Keeping GDP per capita on a log scale, life expectancy on a linear scale, and population mapped via a square-root radius scale.
- Result: large circles now correspond to truly high-population countries (e.g., China, India) instead of regional aggregates.

## Radar Chart – Development Indicators

- **Before:** The radar chart often rendered blank or nearly flat shapes because of inconsistent year selection and poorly scaled population normalization, so development differences between countries were not visible.
- Normalized indicators as:
  - GDP per capita: 0–70,000 USD.
  - Life expectancy: 55–85 years (values below 55 are clamped to 0% to emphasize realistic modern ranges).
  - Population (M): 0–1,500 million (population divided by 1,000,000 before normalization).
- Ensured the radar chart:
  - Uses 2020 data if available, otherwise falls back to the latest year in `healthData`.
  - Filters to real countries only and draws visible filled polygons plus per-country points and legend entries.

## Trajectory Chart – Development Paths

- **Before:** The trajectory chart was wired to the small sample dataset and could not show coherent paths over the full 1960–2020 period for the selected countries.
- Used the full `healthData` time series to plot connected scatter trajectories for selected countries (GDP per capita vs. life expectancy over time).
- Verified axes (log GDP per capita, linear life expectancy) and legends for clarity.

## Global Development Patterns – Choropleth Map

- **Before:** The map showed only a handful of point markers with hard-coded values, the color scale and legend changed unpredictably over time, and countries flipped between colors in ways that did not reflect real trends.
- Replaced the earlier 6-dot Mapbox demo with a **country-level choropleth** driven by `healthData`:
  - Uses Mapbox `country-boundaries` vector tiles joined to World Bank ISO3 codes (`countryCode`).
  - Colors every country we have data for, instead of just a few markers.
- Limited the indicator dropdown to:
  - GDP Per Capita.
  - Life Expectancy.
- Implemented **stable, dynamic color scales**:
  - Precomputed global domains across all years for GDP per capita and life expectancy.
  - For GDP per capita:
    - Used **log10 scaling** with outlier trimming (5th–95th percentile in log space).
    - Applied a multi-hue gradient **white → yellow → green → blue** via `d3.interpolateRgbBasis`.
  - For life expectancy:
    - Used a linear `Viridis` scale across global min–max.
- Fixed the legend to show the **full spectrum**:
  - For GDP: samples the color scale in log space but labels ticks with raw dollar values.
  - For life expectancy: samples and labels directly in years.

## General Fixes & Cleanups

- **Before:** Different charts used inconsistent data subsets, sometimes mixed aggregates with countries, and did not always handle missing years gracefully (causing empty or misleading visuals).
- Ensured the race plot, bubble chart, radar, trajectories, and choropleth all:
  - Use the same `healthData` source.
  - Exclude aggregate World Bank entities.
  - Handle missing years gracefully (fallback to the nearest or latest valid year as appropriate).


